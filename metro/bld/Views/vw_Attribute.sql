
CREATE VIEW [bld].[vw_attribute] AS /*
        View is generated by  : metro
        Generated at          : 2024-12-24 08:25:25
        Description           : View on stage table
        */  WITH cur AS

        (SELECT [attributeid] AS [attributeid],

               [bk] AS [bk],

               [code] AS [code],

               [name] AS [name],

               [bk_dataset] AS [bk_dataset],

               [dataset] AS [dataset],

               [attributename] AS [attributename],

               [description] AS [description],

               [expression] AS [expression],

               [distributionhashkey] AS [distributionhashkey],

               [notinrh] AS [notinrh],

               [businesskey] AS [businesskey],

               [ismta] AS [ismta],

               [srcname] AS [srcname],

               [bk_reftype_datatype] AS [bk_reftype_datatype],

               [datatype] AS [datatype],

               [fixedschemadatatype] AS [fixedschemadatatype],

               [orgmappeddatatype] AS [orgmappeddatatype],

               [isnullable] AS [isnullable],

               [ordinalposition] AS [ordinalposition],

               [maximumlength] AS [maximumlength],

               [precision] AS [precision],

               [scale] AS [scale],

               [collation] AS [collation],

               [active] AS [active],

               [floworder] AS [floworder],

               [bk_reftype_objecttype] AS [bk_reftype_objecttype],

               [bk_reftype_repositorystatus] AS [bk_reftype_repositorystatus],

               [defaultvalue] AS [defaultvalue],

               [ddl_type1] AS [ddl_type1],

               [ddl_type2] AS [ddl_type2],

               [ddl_type3] AS [ddl_type3],

               [ddl_type4] AS [ddl_type4],

               [mta_rectype],

               [mta_createdate],

               [mta_source],

               [mta_bk],

               [mta_bkh],

               [mta_rh],

               [mta_currentflag] = row_number() OVER (PARTITION BY [mta_bkh]
                                                 ORDER BY [mta_createdate] DESC)

          FROM [bld].[attribute]
       )
SELECT [attributeid] AS [attributeid],

       [bk] AS [bk],

       [code] AS [code],

       [name] AS [name],

       [bk_dataset] AS [bk_dataset],

       [dataset] AS [dataset],

       [attributename] AS [attributename],

       [description] AS [description],

       [expression] AS [expression],

       [distributionhashkey] AS [distributionhashkey],

       [notinrh] AS [notinrh],

       [businesskey] AS [businesskey],

       [ismta] AS [ismta],

       [srcname] AS [srcname],

       [bk_reftype_datatype] AS [bk_reftype_datatype],

       [datatype] AS [datatype],

       [fixedschemadatatype] AS [fixedschemadatatype],

       [orgmappeddatatype] AS [orgmappeddatatype],

       [isnullable] AS [isnullable],

       [ordinalposition] AS [ordinalposition],

       [maximumlength] AS [maximumlength],

       [precision] AS [precision],

       [scale] AS [scale],

       [collation] AS [collation],

       [active] AS [active],

       [floworder] AS [floworder],

       [bk_reftype_objecttype] AS [bk_reftype_objecttype],

       [bk_reftype_repositorystatus] AS [bk_reftype_repositorystatus],

       [defaultvalue] AS [defaultvalue],

       [ddl_type1] AS [ddl_type1],

       [ddl_type2] AS [ddl_type2],

       [ddl_type3] AS [ddl_type3],

       [ddl_type4] AS [ddl_type4],

       [mta_rectype],

       [mta_createdate],

       [mta_source],

       [mta_bk],

       [mta_bkh],

       [mta_rh],

       [mta_isdeleted] = iif([mta_rectype] = -1, 1, 0)

  FROM cur

 WHERE [mta_currentflag] = 1

   AND [mta_rectype] > -1
