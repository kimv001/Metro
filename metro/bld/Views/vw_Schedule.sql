
CREATE VIEW [bld].[vw_schedule] AS /*
        View is generated by  : metro
        Generated at          : 2025-01-06 14:43:22
        Description           : View on stage table
        */  WITH cur AS

        (SELECT [scheduleid] AS [scheduleid],

               [bk] AS [bk],

               [code] AS [code],

               [bk_schedule] AS [bk_schedule],

               [schedulecode] AS [schedulecode],

               [schedulename] AS [schedulename],

               [scheduledesc] AS [scheduledesc],

               [startdate] AS [startdate],

               [enddate] AS [enddate],

               [starttime] AS [starttime],

               [endtime] AS [endtime],

               [bk_scheduletype] AS [bk_scheduletype],

               [scheduletypecode] AS [scheduletypecode],

               [scheduletypename] AS [scheduletypename],

               [bk_schedulefrequency] AS [bk_schedulefrequency],

               [schedulefrequencycode] AS [schedulefrequencycode],

               [schedulefrequencyname] AS [schedulefrequencyname],

               [bk_scheduledailyinterval] AS [bk_scheduledailyinterval],

               [scheduledailyintervalcode] AS [scheduledailyintervalcode],

               [scheduledailyintervalname] AS [scheduledailyintervalname],

               [bk_scheduleweeklyinterval] AS [bk_scheduleweeklyinterval],

               [scheduleweeklyintervalcode] AS [scheduleweeklyintervalcode],

               [scheduleweeklyintervalname] AS [scheduleweeklyintervalname],

               [bk_scheduleworkdayinterval] AS [bk_scheduleworkdayinterval],

               [scheduleworkdayintervalcode] AS [scheduleworkdayintervalcode],

               [scheduleworkdayintervalname] AS [scheduleworkdayintervalname],

               [bk_schedulemonthlyinterval] AS [bk_schedulemonthlyinterval],

               [schedulemonthlyintervalcode] AS [schedulemonthlyintervalcode],

               [schedulemonthlyintervalname] AS [schedulemonthlyintervalname],

               [bk_schedulequarterlyinterval] AS [bk_schedulequarterlyinterval],

               [schedulequarterlyintervalcode] AS [schedulequarterlyintervalcode],

               [schedulequarterlyintervalname] AS [schedulequarterlyintervalname],

               [bk_scheduleyearlyinterval] AS [bk_scheduleyearlyinterval],

               [scheduleyearlyintervalcode] AS [scheduleyearlyintervalcode],

               [scheduleyearlyintervalname] AS [scheduleyearlyintervalname],

               [bk_schedulespecials] AS [bk_schedulespecials],

               [schedulespecialscode] AS [schedulespecialscode],

               [schedulespecialsname] AS [schedulespecialsname],

               [mta_rectype],

               [mta_createdate],

               [mta_source],

               [mta_bk],

               [mta_bkh],

               [mta_rh],

               [mta_currentflag] = row_number() OVER (PARTITION BY [mta_bkh]
                                                 ORDER BY [mta_createdate] DESC)

          FROM [bld].[schedule]
       )
SELECT [scheduleid] AS [scheduleid],

       [bk] AS [bk],

       [code] AS [code],

       [bk_schedule] AS [bk_schedule],

       [schedulecode] AS [schedulecode],

       [schedulename] AS [schedulename],

       [scheduledesc] AS [scheduledesc],

       [startdate] AS [startdate],

       [enddate] AS [enddate],

       [starttime] AS [starttime],

       [endtime] AS [endtime],

       [bk_scheduletype] AS [bk_scheduletype],

       [scheduletypecode] AS [scheduletypecode],

       [scheduletypename] AS [scheduletypename],

       [bk_schedulefrequency] AS [bk_schedulefrequency],

       [schedulefrequencycode] AS [schedulefrequencycode],

       [schedulefrequencyname] AS [schedulefrequencyname],

       [bk_scheduledailyinterval] AS [bk_scheduledailyinterval],

       [scheduledailyintervalcode] AS [scheduledailyintervalcode],

       [scheduledailyintervalname] AS [scheduledailyintervalname],

       [bk_scheduleweeklyinterval] AS [bk_scheduleweeklyinterval],

       [scheduleweeklyintervalcode] AS [scheduleweeklyintervalcode],

       [scheduleweeklyintervalname] AS [scheduleweeklyintervalname],

       [bk_scheduleworkdayinterval] AS [bk_scheduleworkdayinterval],

       [scheduleworkdayintervalcode] AS [scheduleworkdayintervalcode],

       [scheduleworkdayintervalname] AS [scheduleworkdayintervalname],

       [bk_schedulemonthlyinterval] AS [bk_schedulemonthlyinterval],

       [schedulemonthlyintervalcode] AS [schedulemonthlyintervalcode],

       [schedulemonthlyintervalname] AS [schedulemonthlyintervalname],

       [bk_schedulequarterlyinterval] AS [bk_schedulequarterlyinterval],

       [schedulequarterlyintervalcode] AS [schedulequarterlyintervalcode],

       [schedulequarterlyintervalname] AS [schedulequarterlyintervalname],

       [bk_scheduleyearlyinterval] AS [bk_scheduleyearlyinterval],

       [scheduleyearlyintervalcode] AS [scheduleyearlyintervalcode],

       [scheduleyearlyintervalname] AS [scheduleyearlyintervalname],

       [bk_schedulespecials] AS [bk_schedulespecials],

       [schedulespecialscode] AS [schedulespecialscode],

       [schedulespecialsname] AS [schedulespecialsname],

       [mta_rectype],

       [mta_createdate],

       [mta_source],

       [mta_bk],

       [mta_bkh],

       [mta_rh],

       [mta_isdeleted] = iif([mta_rectype] = -1, 1, 0)

  FROM cur

 WHERE [mta_currentflag] = 1

   AND [mta_rectype] > -1
