
        CREATE   VIEW [bld].[vw_Schema] AS
        /*
        View is generated by  : metro
        Generated at          : 2025-01-21 08:32:49
        Description           : View on stage table
        */
        WITH Cur AS (
            SELECT 
                [SchemaId] AS [SchemaId],
                [BK] AS [BK],
                [Code] AS [Code],
                [Name] AS [Name],
                [BK_Schema] AS [BK_Schema],
                [BK_Layer] AS [BK_Layer],
                [BK_DataSource] AS [BK_DataSource],
                [BK_LinkedService] AS [BK_LinkedService],
                [SchemaCode] AS [SchemaCode],
                [SchemaName] AS [SchemaName],
                [DataSourceCode] AS [DataSourceCode],
                [DataSourceName] AS [DataSourceName],
                [BK_DataSourceType] AS [BK_DataSourceType],
                [DataSourceTypeCode] AS [DataSourceTypeCode],
                [DataSourceTypeName] AS [DataSourceTypeName],
                [LayerCode] AS [LayerCode],
                [LayerName] AS [LayerName],
                [LayerOrder] AS [LayerOrder],
                [ProcessOrderLayer] AS [ProcessOrderLayer],
                [ProcessParallel] AS [ProcessParallel],
                [isDWH] AS [isDWH],
                [isSRC] AS [isSRC],
                [isTGT] AS [isTGT],
                [IsREP] AS [IsRep],
                [CreateDummies] AS [CreateDummies],
                [LinkedServiceCode] AS [LinkedServiceCode],
                [LinkedServiceName] AS [LinkedServiceName],
                [BK_Template_Create] AS [BK_Template_Create],
                [BK_Template_Load] AS [BK_Template_Load],
                [BK_RefType_ToChar] AS [BK_RefType_ToChar],
                [mta_RecType], [mta_CreateDate], [mta_Source], [mta_BK], [mta_BKH], [mta_RH],
                [mta_CurrentFlag] = ROW_NUMBER() OVER (PARTITION BY [mta_BKH] ORDER BY [mta_CreateDate] DESC)
            FROM [bld].[Schema]
               
        )
        SELECT 
            [SchemaId] AS [SchemaId],
            [BK] AS [BK],
            [Code] AS [Code],
            [Name] AS [Name],
            [BK_Schema] AS [BK_Schema],
            [BK_Layer] AS [BK_Layer],
            [BK_DataSource] AS [BK_DataSource],
            [BK_LinkedService] AS [BK_LinkedService],
            [SchemaCode] AS [SchemaCode],
            [SchemaName] AS [SchemaName],
            [DataSourceCode] AS [DataSourceCode],
            [DataSourceName] AS [DataSourceName],
            [BK_DataSourceType] AS [BK_DataSourceType],
            [DataSourceTypeCode] AS [DataSourceTypeCode],
            [DataSourceTypeName] AS [DataSourceTypeName],
            [LayerCode] AS [LayerCode],
            [LayerName] AS [LayerName],
            [LayerOrder] AS [LayerOrder],
            [ProcessOrderLayer] AS [ProcessOrderLayer],
            [ProcessParallel] AS [ProcessParallel],
            [isDWH] AS [isDWH],
            [isSRC] AS [isSRC],
            [isTGT] AS [isTGT],
            [IsREP] AS [IsRep],
            [CreateDummies] AS [CreateDummies],
            [LinkedServiceCode] AS [LinkedServiceCode],
            [LinkedServiceName] AS [LinkedServiceName],
            [BK_Template_Create] AS [BK_Template_Create],
            [BK_Template_Load] AS [BK_Template_Load],
            [BK_RefType_ToChar] AS [BK_RefType_ToChar],
            [mta_RecType], [mta_CreateDate], [mta_Source], [mta_BK], [mta_BKH], [mta_RH],
            [mta_IsDeleted] = IIF([mta_RecType] = -1, 1, 0)
        FROM Cur
        WHERE [mta_CurrentFlag] = 1 AND [mta_RecType] > -1