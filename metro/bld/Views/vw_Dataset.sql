
CREATE VIEW [bld].[vw_dataset] AS /*
        View is generated by  : metro
        Generated at          : 2024-12-24 08:25:25
        Description           : View on stage table
        */  WITH cur AS

        (SELECT [datasetid] AS [datasetid],

               [bk] AS [bk],

               [code] AS [code],

               [datasetname] AS [datasetname],

               [schemaname] AS [schemaname],

               [datasource] AS [datasource],

               [bk_schema] AS [bk_schema],

               [bk_group] AS [bk_group],

               [bk_segment] AS [bk_segment],

               [bk_bucket] AS [bk_bucket],

               [shortname] AS [shortname],

               [src_shortname] AS [src_shortname],

               [dwhtargetshortname] AS [dwhtargetshortname],

               [replaceattributenames] AS [replaceattributenames],

               [prefix] AS [prefix],

               [postfix] AS [postfix],

               [description] AS [description],

               [bk_contactgroup] AS [bk_contactgroup],

               [bk_contactgroup_data_logistics] AS [bk_contactgroup_data_logistics],

               [data_logistics_info] AS [data_logistics_info],

               [bk_contactgroup_data_supplier] AS [bk_contactgroup_data_supplier],

               [data_supplier_info] AS [data_supplier_info],

               [bk_flow] AS [bk_flow],

               [timestamp] AS [timestamp],

               [businessdate] AS [businessdate],

               [recordsrcdate] AS [recordsrcdate],

               [wherefilter] AS [wherefilter],

               [scd] AS [scd],

               [distinctvalues] AS [distinctvalues],

               [partitionstatement] AS [partitionstatement],

               [bk_reftype_objecttype] AS [bk_reftype_objecttype],

               [fullload] AS [fullload],

               [insertonly] AS [insertonly],

               [insertnocheck] AS [insertnocheck],

               [bigdata] AS [bigdata],

               [bk_template_load] AS [bk_template_load],

               [bk_template_create] AS [bk_template_create],

               [customstagingview] AS [customstagingview],

               [bk_reftype_repositorystatus] AS [bk_reftype_repositorystatus],

               [issystem] AS [issystem],

               [layername] AS [layername],

               [bk_linkedservice] AS [bk_linkedservice],

               [linkedservicename] AS [linkedservicename],

               [bk_datasource] AS [bk_datasource],

               [bk_layer] AS [bk_layer],

               [createdummies] AS [createdummies],

               [floworder] AS [floworder],

               [floworderdesc] AS [floworderdesc],

               [firstdefaultdwhview] AS [firstdefaultdwhview],

               [datasettype] AS [datasettype],

               [objecttype] AS [objecttype],

               [src_objecttype] AS [src_objecttype],

               [tgt_objecttype] AS [tgt_objecttype],

               [repositorystatusname] AS [repositorystatusname],

               [repositorystatuscode] AS [repositorystatuscode],

               [isdwh] AS [isdwh],

               [issrc] AS [issrc],

               [istgt] AS [istgt],

               [isrep] AS [isrep],

               [view_defintion_contains_business_logic] AS [view_defintion_contains_business_logic],

               [view_defintion] AS [view_defintion],

               [todeploy] AS [todeploy],

               [mta_rectype],

               [mta_createdate],

               [mta_source],

               [mta_bk],

               [mta_bkh],

               [mta_rh],

               [mta_currentflag] = row_number() OVER (PARTITION BY [mta_bkh]
                                                 ORDER BY [mta_createdate] DESC)

          FROM [bld].[dataset]
       )
SELECT [datasetid] AS [datasetid],

       [bk] AS [bk],

       [code] AS [code],

       [datasetname] AS [datasetname],

       [schemaname] AS [schemaname],

       [datasource] AS [datasource],

       [bk_schema] AS [bk_schema],

       [bk_group] AS [bk_group],

       [bk_segment] AS [bk_segment],

       [bk_bucket] AS [bk_bucket],

       [shortname] AS [shortname],

       [src_shortname] AS [src_shortname],

       [dwhtargetshortname] AS [dwhtargetshortname],

       [replaceattributenames] AS [replaceattributenames],

       [prefix] AS [prefix],

       [postfix] AS [postfix],

       [description] AS [description],

       [bk_contactgroup] AS [bk_contactgroup],

       [bk_contactgroup_data_logistics] AS [bk_contactgroup_data_logistics],

       [data_logistics_info] AS [data_logistics_info],

       [bk_contactgroup_data_supplier] AS [bk_contactgroup_data_supplier],

       [data_supplier_info] AS [data_supplier_info],

       [bk_flow] AS [bk_flow],

       [timestamp] AS [timestamp],

       [businessdate] AS [businessdate],

       [recordsrcdate] AS [recordsrcdate],

       [wherefilter] AS [wherefilter],

       [scd] AS [scd],

       [distinctvalues] AS [distinctvalues],

       [partitionstatement] AS [partitionstatement],

       [bk_reftype_objecttype] AS [bk_reftype_objecttype],

       [fullload] AS [fullload],

       [insertonly] AS [insertonly],

       [insertnocheck] AS [insertnocheck],

       [bigdata] AS [bigdata],

       [bk_template_load] AS [bk_template_load],

       [bk_template_create] AS [bk_template_create],

       [customstagingview] AS [customstagingview],

       [bk_reftype_repositorystatus] AS [bk_reftype_repositorystatus],

       [issystem] AS [issystem],

       [layername] AS [layername],

       [bk_linkedservice] AS [bk_linkedservice],

       [linkedservicename] AS [linkedservicename],

       [bk_datasource] AS [bk_datasource],

       [bk_layer] AS [bk_layer],

       [createdummies] AS [createdummies],

       [floworder] AS [floworder],

       [floworderdesc] AS [floworderdesc],

       [firstdefaultdwhview] AS [firstdefaultdwhview],

       [datasettype] AS [datasettype],

       [objecttype] AS [objecttype],

       [src_objecttype] AS [src_objecttype],

       [tgt_objecttype] AS [tgt_objecttype],

       [repositorystatusname] AS [repositorystatusname],

       [repositorystatuscode] AS [repositorystatuscode],

       [isdwh] AS [isdwh],

       [issrc] AS [issrc],

       [istgt] AS [istgt],

       [isrep] AS [isrep],

       [view_defintion_contains_business_logic] AS [view_defintion_contains_business_logic],

       [view_defintion] AS [view_defintion],

       [todeploy] AS [todeploy],

       [mta_rectype],

       [mta_createdate],

       [mta_source],

       [mta_bk],

       [mta_bkh],

       [mta_rh],

       [mta_isdeleted] = iif([mta_rectype] = -1, 1, 0)

  FROM cur

 WHERE [mta_currentflag] = 1

   AND [mta_rectype] > -1
