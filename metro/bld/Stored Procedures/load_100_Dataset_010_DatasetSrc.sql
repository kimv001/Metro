
	CREATE PROC [bld].[load_100_Dataset_010_DatasetSrc] AS
	/*
	Proc is generated by	: metro
	Generated at			: 2025-01-21 08:32:54
	
	exec [bld].[load_100_Dataset_010_DatasetSrc]*/

	
	DECLARE @RoutineName	varchar(8000)	= 'load_100_Dataset_010_DatasetSrc'
	DECLARE @StartDateTime	datetime2		=  getutcdate()
	DECLARE @EndDateTime	datetime2		
	DECLARE @Duration		bigint



	-- Create a helper temp table
	IF OBJECT_ID('tempdb..#100_Dataset_010_DatasetSrc') IS NOT NULL 
	DROP TABLE #100_Dataset_010_DatasetSrc ;
	PRINT '-- create temp table:'
	SELECT
	  mta_BK		= src.[BK]
	, mta_BKH		= CONVERT(char(64),(Hashbytes('sha2_512',upper(src.BK) )),2)
	, mta_RH		= CONVERT(char(64),(Hashbytes('sha2_512',upper(
								ISNULL(CAST(src.[BK] AS varchar(8000)),'-')
								+'|'
								+ISNULL(CAST(src.[Code] AS varchar(8000)),'-')
								+'|'
								+ISNULL(CAST(src.[DatasetName] AS varchar(8000)),'-')
								+'|'
								+ISNULL(CAST(src.[SchemaName] AS varchar(8000)),'-')
								+'|'
								+ISNULL(CAST(src.[DataSource] AS varchar(8000)),'-')
								+'|'
								+ISNULL(CAST(src.[BK_Schema] AS varchar(8000)),'-')
								+'|'
								+ISNULL(CAST(src.[BK_Group] AS varchar(8000)),'-')
								+'|'
								+ISNULL(CAST(src.[BK_Segment] AS varchar(8000)),'-')
								+'|'
								+ISNULL(CAST(src.[BK_Bucket] AS varchar(8000)),'-')
								+'|'
								+ISNULL(CAST(src.[ShortName] AS varchar(8000)),'-')
								+'|'
								+ISNULL(CAST(src.[SRC_ShortName] AS varchar(8000)),'-')
								+'|'
								+ISNULL(CAST(src.[dwhTargetShortName] AS varchar(8000)),'-')
								+'|'
								+ISNULL(CAST(src.[ReplaceAttributeNames] AS varchar(8000)),'-')
								+'|'
								+ISNULL(CAST(src.[Prefix] AS varchar(8000)),'-')
								+'|'
								+ISNULL(CAST(src.[PostFix] AS varchar(8000)),'-')
								+'|'
								+ISNULL(CAST(src.[Description] AS varchar(8000)),'-')
								+'|'
								+ISNULL(CAST(src.[BK_ContactGroup] AS varchar(8000)),'-')
								+'|'
								+ISNULL(CAST(src.[bk_ContactGroup_Data_Logistics] AS varchar(8000)),'-')
								+'|'
								+ISNULL(CAST(src.[Data_Logistics_Info] AS varchar(8000)),'-')
								+'|'
								+ISNULL(CAST(src.[bk_ContactGroup_Data_Supplier] AS varchar(8000)),'-')
								+'|'
								+ISNULL(CAST(src.[Data_Supplier_Info] AS varchar(8000)),'-')
								+'|'
								+ISNULL(CAST(src.[BK_Flow] AS varchar(8000)),'-')
								+'|'
								+ISNULL(CAST(src.[TimeStamp] AS varchar(8000)),'-')
								+'|'
								+ISNULL(CAST(src.[BusinessDate] AS varchar(8000)),'-')
								+'|'
								+ISNULL(CAST(src.[RecordSrcDate] AS varchar(8000)),'-')
								+'|'
								+ISNULL(CAST(src.[WhereFilter] AS varchar(8000)),'-')
								+'|'
								+ISNULL(CAST(src.[SCD] AS varchar(8000)),'-')
								+'|'
								+ISNULL(CAST(src.[DistinctValues] AS varchar(8000)),'-')
								+'|'
								+ISNULL(CAST(src.[PartitionStatement] AS varchar(8000)),'-')
								+'|'
								+ISNULL(CAST(src.[BK_RefType_ObjectType] AS varchar(8000)),'-')
								+'|'
								+ISNULL(CAST(src.[FullLoad] AS varchar(8000)),'-')
								+'|'
								+ISNULL(CAST(src.[InsertOnly] AS varchar(8000)),'-')
								+'|'
								+ISNULL(CAST(src.[InsertNoCheck] AS varchar(8000)),'-')
								+'|'
								+ISNULL(CAST(src.[BigData] AS varchar(8000)),'-')
								+'|'
								+ISNULL(CAST(src.[BK_Template_Load] AS varchar(8000)),'-')
								+'|'
								+ISNULL(CAST(src.[BK_Template_Create] AS varchar(8000)),'-')
								+'|'
								+ISNULL(CAST(src.[CustomStagingView] AS varchar(8000)),'-')
								+'|'
								+ISNULL(CAST(src.[BK_RefType_RepositoryStatus] AS varchar(8000)),'-')
								+'|'
								+ISNULL(CAST(src.[IsSystem] AS varchar(8000)),'-')
								+'|'
								+ISNULL(CAST(src.[LayerName] AS varchar(8000)),'-')
								+'|'
								+ISNULL(CAST(src.[BK_LinkedService] AS varchar(8000)),'-')
								+'|'
								+ISNULL(CAST(src.[LinkedServiceName] AS varchar(8000)),'-')
								+'|'
								+ISNULL(CAST(src.[BK_DataSource] AS varchar(8000)),'-')
								+'|'
								+ISNULL(CAST(src.[BK_Layer] AS varchar(8000)),'-')
								+'|'
								+ISNULL(CAST(src.[CreateDummies] AS varchar(8000)),'-')
								+'|'
								+ISNULL(CAST(src.[FlowOrder] AS varchar(8000)),'-')
								+'|'
								+ISNULL(CAST(src.[FlowOrderDesc] AS varchar(8000)),'-')
								+'|'
								+ISNULL(CAST(src.[FirstDefaultDWHView] AS varchar(8000)),'-')
								+'|'
								+ISNULL(CAST(src.[DatasetType] AS varchar(8000)),'-')
								+'|'
								+ISNULL(CAST(src.[ObjectType] AS varchar(8000)),'-')
								+'|'
								+ISNULL(CAST(src.[SRC_ObjectType] AS varchar(8000)),'-')
								+'|'
								+ISNULL(CAST(src.[TGT_ObjectType] AS varchar(8000)),'-')
								+'|'
								+ISNULL(CAST(src.[RepositoryStatusName] AS varchar(8000)),'-')
								+'|'
								+ISNULL(CAST(src.[RepositoryStatusCode] AS varchar(8000)),'-')
								+'|'
								+ISNULL(CAST(src.[isDWH] AS varchar(8000)),'-')
								+'|'
								+ISNULL(CAST(src.[isSRC] AS varchar(8000)),'-')
								+'|'
								+ISNULL(CAST(src.[isTGT] AS varchar(8000)),'-')
								+'|'
								+ISNULL(CAST(src.[isRep] AS varchar(8000)),'-')
								+'|'
								+ISNULL(CAST(src.[view_defintion_contains_business_logic] AS varchar(8000)),'-')
								+'|'
								+ISNULL(CAST(src.[view_defintion] AS varchar(8000)),'-')
								+'|'
								+ISNULL(CAST(src.[ToDeploy] AS varchar(8000)),'-') 
							))),2)
	, mta_Source	= '[bld].[tr_100_Dataset_010_DatasetSrc]'
	, mta_RecType	= CASE 
												WHEN tgt.[BK] IS null THEN 1
												WHEN
												    tgt.[mta_RH]
												    !=  CONVERT(
												        char(64),
												        (
												            Hashbytes(
												                'sha2_512',
												                upper(
												                    ISNULL(CAST(src.[BK] AS varchar(8000)),'-')
												                    +'|'
												                    +ISNULL(CAST(src.[Code] AS varchar(8000)),'-')
												                    +'|'
												                    +ISNULL(CAST(src.[DatasetName] AS varchar(8000)),'-')
												                    +'|'
												                    +ISNULL(CAST(src.[SchemaName] AS varchar(8000)),'-')
												                    +'|'
												                    +ISNULL(CAST(src.[DataSource] AS varchar(8000)),'-')
												                    +'|'
												                    +ISNULL(CAST(src.[BK_Schema] AS varchar(8000)),'-')
												                    +'|'
												                    +ISNULL(CAST(src.[BK_Group] AS varchar(8000)),'-')
												                    +'|'
												                    +ISNULL(CAST(src.[BK_Segment] AS varchar(8000)),'-')
												                    +'|'
												                    +ISNULL(CAST(src.[BK_Bucket] AS varchar(8000)),'-')
												                    +'|'
												                    +ISNULL(CAST(src.[ShortName] AS varchar(8000)),'-')
												                    +'|'
												                    +ISNULL(CAST(src.[SRC_ShortName] AS varchar(8000)),'-')
												                    +'|'
												                    +ISNULL(CAST(src.[dwhTargetShortName] AS varchar(8000)),'-')
												                    +'|'
												                    +ISNULL(CAST(src.[ReplaceAttributeNames] AS varchar(8000)),'-')
												                    +'|'
												                    +ISNULL(CAST(src.[Prefix] AS varchar(8000)),'-')
												                    +'|'
												                    +ISNULL(CAST(src.[PostFix] AS varchar(8000)),'-')
												                    +'|'
												                    +ISNULL(CAST(src.[Description] AS varchar(8000)),'-')
												                    +'|'
												                    +ISNULL(CAST(src.[BK_ContactGroup] AS varchar(8000)),'-')
												                    +'|'
												                    +ISNULL(CAST(src.[bk_ContactGroup_Data_Logistics] AS varchar(8000)),'-')
												                    +'|'
												                    +ISNULL(CAST(src.[Data_Logistics_Info] AS varchar(8000)),'-')
												                    +'|'
												                    +ISNULL(CAST(src.[bk_ContactGroup_Data_Supplier] AS varchar(8000)),'-')
												                    +'|'
												                    +ISNULL(CAST(src.[Data_Supplier_Info] AS varchar(8000)),'-')
												                    +'|'
												                    +ISNULL(CAST(src.[BK_Flow] AS varchar(8000)),'-')
												                    +'|'
												                    +ISNULL(CAST(src.[TimeStamp] AS varchar(8000)),'-')
												                    +'|'
												                    +ISNULL(CAST(src.[BusinessDate] AS varchar(8000)),'-')
												                    +'|'
												                    +ISNULL(CAST(src.[RecordSrcDate] AS varchar(8000)),'-')
												                    +'|'
												                    +ISNULL(CAST(src.[WhereFilter] AS varchar(8000)),'-')
												                    +'|'
												                    +ISNULL(CAST(src.[SCD] AS varchar(8000)),'-')
												                    +'|'
												                    +ISNULL(CAST(src.[DistinctValues] AS varchar(8000)),'-')
												                    +'|'
												                    +ISNULL(CAST(src.[PartitionStatement] AS varchar(8000)),'-')
												                    +'|'
												                    +ISNULL(CAST(src.[BK_RefType_ObjectType] AS varchar(8000)),'-')
												                    +'|'
												                    +ISNULL(CAST(src.[FullLoad] AS varchar(8000)),'-')
												                    +'|'
												                    +ISNULL(CAST(src.[InsertOnly] AS varchar(8000)),'-')
												                    +'|'
												                    +ISNULL(CAST(src.[InsertNoCheck] AS varchar(8000)),'-')
												                    +'|'
												                    +ISNULL(CAST(src.[BigData] AS varchar(8000)),'-')
												                    +'|'
												                    +ISNULL(CAST(src.[BK_Template_Load] AS varchar(8000)),'-')
												                    +'|'
												                    +ISNULL(CAST(src.[BK_Template_Create] AS varchar(8000)),'-')
												                    +'|'
												                    +ISNULL(CAST(src.[CustomStagingView] AS varchar(8000)),'-')
												                    +'|'
												                    +ISNULL(CAST(src.[BK_RefType_RepositoryStatus] AS varchar(8000)),'-')
												                    +'|'
												                    +ISNULL(CAST(src.[IsSystem] AS varchar(8000)),'-')
												                    +'|'
												                    +ISNULL(CAST(src.[LayerName] AS varchar(8000)),'-')
												                    +'|'
												                    +ISNULL(CAST(src.[BK_LinkedService] AS varchar(8000)),'-')
												                    +'|'
												                    +ISNULL(CAST(src.[LinkedServiceName] AS varchar(8000)),'-')
												                    +'|'
												                    +ISNULL(CAST(src.[BK_DataSource] AS varchar(8000)),'-')
												                    +'|'
												                    +ISNULL(CAST(src.[BK_Layer] AS varchar(8000)),'-')
												                    +'|'
												                    +ISNULL(CAST(src.[CreateDummies] AS varchar(8000)),'-')
												                    +'|'
												                    +ISNULL(CAST(src.[FlowOrder] AS varchar(8000)),'-')
												                    +'|'
												                    +ISNULL(CAST(src.[FlowOrderDesc] AS varchar(8000)),'-')
												                    +'|'
												                    +ISNULL(CAST(src.[FirstDefaultDWHView] AS varchar(8000)),'-')
												                    +'|'
												                    +ISNULL(CAST(src.[DatasetType] AS varchar(8000)),'-')
												                    +'|'
												                    +ISNULL(CAST(src.[ObjectType] AS varchar(8000)),'-')
												                    +'|'
												                    +ISNULL(CAST(src.[SRC_ObjectType] AS varchar(8000)),'-')
												                    +'|'
												                    +ISNULL(CAST(src.[TGT_ObjectType] AS varchar(8000)),'-')
												                    +'|'
												                    +ISNULL(CAST(src.[RepositoryStatusName] AS varchar(8000)),'-')
												                    +'|'
												                    +ISNULL(CAST(src.[RepositoryStatusCode] AS varchar(8000)),'-')
												                    +'|'
												                    +ISNULL(CAST(src.[isDWH] AS varchar(8000)),'-')
												                    +'|'
												                    +ISNULL(CAST(src.[isSRC] AS varchar(8000)),'-')
												                    +'|'
												                    +ISNULL(CAST(src.[isTGT] AS varchar(8000)),'-')
												                    +'|'
												                    +ISNULL(CAST(src.[isRep] AS varchar(8000)),'-')
												                    +'|'
												                    +ISNULL(CAST(src.[view_defintion_contains_business_logic] AS varchar(8000)),'-')
												                    +'|'
												                    +ISNULL(CAST(src.[view_defintion] AS varchar(8000)),'-')
												                    +'|'
												                    +ISNULL(CAST(src.[ToDeploy] AS varchar(8000)),'-')
												                )
												            )
												        ),
												        2
												    )
						THEN 0
						ELSE -99 END
	
	INTO #100_Dataset_010_DatasetSrc
	FROM [bld].[tr_100_Dataset_010_DatasetSrc] src
	LEFT JOIN [bld].[vw_Dataset] tgt ON src.[BK] = tgt.[BK]
	
	
	
	CREATE CLUSTERED INDEX [IX_tr_100_Dataset_010_DatasetSrc] ON #100_Dataset_010_DatasetSrc( [mta_BKH] ASC,[mta_RH] ASC)
	
	
	--------------------- start loading data
	
	PRINT '-- new records:'
	
	SET @StartDateTime = getdate()
	
	INSERT INTO [bld].[Dataset]
	( 
		[BK] ,
		[Code] ,
		[DatasetName] ,
		[SchemaName] ,
		[DataSource] ,
		[BK_Schema] ,
		[BK_Group] ,
		[BK_Segment] ,
		[BK_Bucket] ,
		[ShortName] ,
		[SRC_ShortName] ,
		[dwhTargetShortName] ,
		[ReplaceAttributeNames] ,
		[Prefix] ,
		[PostFix] ,
		[Description] ,
		[BK_ContactGroup] ,
		[bk_ContactGroup_Data_Logistics] ,
		[Data_Logistics_Info] ,
		[bk_ContactGroup_Data_Supplier] ,
		[Data_Supplier_Info] ,
		[BK_Flow] ,
		[TimeStamp] ,
		[BusinessDate] ,
		[RecordSrcDate] ,
		[WhereFilter] ,
		[SCD] ,
		[DistinctValues] ,
		[PartitionStatement] ,
		[BK_RefType_ObjectType] ,
		[FullLoad] ,
		[InsertOnly] ,
		[InsertNoCheck] ,
		[BigData] ,
		[BK_Template_Load] ,
		[BK_Template_Create] ,
		[CustomStagingView] ,
		[BK_RefType_RepositoryStatus] ,
		[IsSystem] ,
		[LayerName] ,
		[BK_LinkedService] ,
		[LinkedServiceName] ,
		[BK_DataSource] ,
		[BK_Layer] ,
		[CreateDummies] ,
		[FlowOrder] ,
		[FlowOrderDesc] ,
		[FirstDefaultDWHView] ,
		[DatasetType] ,
		[ObjectType] ,
		[SRC_ObjectType] ,
		[TGT_ObjectType] ,
		[RepositoryStatusName] ,
		[RepositoryStatusCode] ,
		[isDWH] ,
		[isSRC] ,
		[isTGT] ,
		[isRep] ,
		[view_defintion_contains_business_logic] ,
		[view_defintion] ,
		[ToDeploy] 
		, [mta_BK], [mta_BKH], [mta_RH], [mta_Source], [mta_RecType]) 
	SELECT 
		src.[BK] ,
		src.[Code] ,
		src.[DatasetName] ,
		src.[SchemaName] ,
		src.[DataSource] ,
		src.[BK_Schema] ,
		src.[BK_Group] ,
		src.[BK_Segment] ,
		src.[BK_Bucket] ,
		src.[ShortName] ,
		src.[SRC_ShortName] ,
		src.[dwhTargetShortName] ,
		src.[ReplaceAttributeNames] ,
		src.[Prefix] ,
		src.[PostFix] ,
		src.[Description] ,
		src.[BK_ContactGroup] ,
		src.[bk_ContactGroup_Data_Logistics] ,
		src.[Data_Logistics_Info] ,
		src.[bk_ContactGroup_Data_Supplier] ,
		src.[Data_Supplier_Info] ,
		src.[BK_Flow] ,
		src.[TimeStamp] ,
		src.[BusinessDate] ,
		src.[RecordSrcDate] ,
		src.[WhereFilter] ,
		src.[SCD] ,
		src.[DistinctValues] ,
		src.[PartitionStatement] ,
		src.[BK_RefType_ObjectType] ,
		src.[FullLoad] ,
		src.[InsertOnly] ,
		src.[InsertNoCheck] ,
		src.[BigData] ,
		src.[BK_Template_Load] ,
		src.[BK_Template_Create] ,
		src.[CustomStagingView] ,
		src.[BK_RefType_RepositoryStatus] ,
		src.[IsSystem] ,
		src.[LayerName] ,
		src.[BK_LinkedService] ,
		src.[LinkedServiceName] ,
		src.[BK_DataSource] ,
		src.[BK_Layer] ,
		src.[CreateDummies] ,
		src.[FlowOrder] ,
		src.[FlowOrderDesc] ,
		src.[FirstDefaultDWHView] ,
		src.[DatasetType] ,
		src.[ObjectType] ,
		src.[SRC_ObjectType] ,
		src.[TGT_ObjectType] ,
		src.[RepositoryStatusName] ,
		src.[RepositoryStatusCode] ,
		src.[isDWH] ,
		src.[isSRC] ,
		src.[isTGT] ,
		src.[isRep] ,
		src.[view_defintion_contains_business_logic] ,
		src.[view_defintion] ,
		src.[ToDeploy] 
		, h.[mta_BK], h.[mta_BKH], h.[mta_RH], h.[mta_Source], h.[mta_RecType]
	FROM  [bld].[tr_100_Dataset_010_DatasetSrc] src
	JOIN #100_Dataset_010_DatasetSrc h ON h.[mta_BK] = src.[BK]
	LEFT JOIN [bld].[vw_Dataset] tgt ON h.[mta_BKH] = tgt.[mta_BKH] 
	WHERE 1=1 AND CAST(h.mta_RecType AS int) = 1 AND tgt.[mta_BKH] IS null
	
	
	SET @EndDateTime = getutcdate()
	EXEC [aud].[proc_Log_Procedure]  
							@LogAction		= 'INSERT - NEW', 
							@LogNote		= 'New Records',
							@LogProcedure	= @RoutineName,
							@LogSQL			= 'Insert Into [bld].[Dataset]',
							@LogRowCount	= @@ROWCOUNT,
							@Log_TimeStart  = @StartDateTime,
							@Log_TimeEnd    = @EndDateTime;
	
	PRINT '-- changed records:'
	SET @StartDateTime = getdate()
	
		INSERT INTO [bld].[Dataset]
	( 
		[BK] ,
		[Code] ,
		[DatasetName] ,
		[SchemaName] ,
		[DataSource] ,
		[BK_Schema] ,
		[BK_Group] ,
		[BK_Segment] ,
		[BK_Bucket] ,
		[ShortName] ,
		[SRC_ShortName] ,
		[dwhTargetShortName] ,
		[ReplaceAttributeNames] ,
		[Prefix] ,
		[PostFix] ,
		[Description] ,
		[BK_ContactGroup] ,
		[bk_ContactGroup_Data_Logistics] ,
		[Data_Logistics_Info] ,
		[bk_ContactGroup_Data_Supplier] ,
		[Data_Supplier_Info] ,
		[BK_Flow] ,
		[TimeStamp] ,
		[BusinessDate] ,
		[RecordSrcDate] ,
		[WhereFilter] ,
		[SCD] ,
		[DistinctValues] ,
		[PartitionStatement] ,
		[BK_RefType_ObjectType] ,
		[FullLoad] ,
		[InsertOnly] ,
		[InsertNoCheck] ,
		[BigData] ,
		[BK_Template_Load] ,
		[BK_Template_Create] ,
		[CustomStagingView] ,
		[BK_RefType_RepositoryStatus] ,
		[IsSystem] ,
		[LayerName] ,
		[BK_LinkedService] ,
		[LinkedServiceName] ,
		[BK_DataSource] ,
		[BK_Layer] ,
		[CreateDummies] ,
		[FlowOrder] ,
		[FlowOrderDesc] ,
		[FirstDefaultDWHView] ,
		[DatasetType] ,
		[ObjectType] ,
		[SRC_ObjectType] ,
		[TGT_ObjectType] ,
		[RepositoryStatusName] ,
		[RepositoryStatusCode] ,
		[isDWH] ,
		[isSRC] ,
		[isTGT] ,
		[isRep] ,
		[view_defintion_contains_business_logic] ,
		[view_defintion] ,
		[ToDeploy] 
		, [mta_BK], [mta_BKH], [mta_RH], [mta_Source], [mta_RecType]) 
	SELECT 
		src.[BK] ,
		src.[Code] ,
		src.[DatasetName] ,
		src.[SchemaName] ,
		src.[DataSource] ,
		src.[BK_Schema] ,
		src.[BK_Group] ,
		src.[BK_Segment] ,
		src.[BK_Bucket] ,
		src.[ShortName] ,
		src.[SRC_ShortName] ,
		src.[dwhTargetShortName] ,
		src.[ReplaceAttributeNames] ,
		src.[Prefix] ,
		src.[PostFix] ,
		src.[Description] ,
		src.[BK_ContactGroup] ,
		src.[bk_ContactGroup_Data_Logistics] ,
		src.[Data_Logistics_Info] ,
		src.[bk_ContactGroup_Data_Supplier] ,
		src.[Data_Supplier_Info] ,
		src.[BK_Flow] ,
		src.[TimeStamp] ,
		src.[BusinessDate] ,
		src.[RecordSrcDate] ,
		src.[WhereFilter] ,
		src.[SCD] ,
		src.[DistinctValues] ,
		src.[PartitionStatement] ,
		src.[BK_RefType_ObjectType] ,
		src.[FullLoad] ,
		src.[InsertOnly] ,
		src.[InsertNoCheck] ,
		src.[BigData] ,
		src.[BK_Template_Load] ,
		src.[BK_Template_Create] ,
		src.[CustomStagingView] ,
		src.[BK_RefType_RepositoryStatus] ,
		src.[IsSystem] ,
		src.[LayerName] ,
		src.[BK_LinkedService] ,
		src.[LinkedServiceName] ,
		src.[BK_DataSource] ,
		src.[BK_Layer] ,
		src.[CreateDummies] ,
		src.[FlowOrder] ,
		src.[FlowOrderDesc] ,
		src.[FirstDefaultDWHView] ,
		src.[DatasetType] ,
		src.[ObjectType] ,
		src.[SRC_ObjectType] ,
		src.[TGT_ObjectType] ,
		src.[RepositoryStatusName] ,
		src.[RepositoryStatusCode] ,
		src.[isDWH] ,
		src.[isSRC] ,
		src.[isTGT] ,
		src.[isRep] ,
		src.[view_defintion_contains_business_logic] ,
		src.[view_defintion] ,
		src.[ToDeploy] 
		, h.[mta_BK], h.[mta_BKH], h.[mta_RH], h.[mta_Source], h.[mta_RecType]
	FROM  [bld].[tr_100_Dataset_010_DatasetSrc] src
	JOIN #100_Dataset_010_DatasetSrc h ON h.[mta_BK] = src.[BK]
	WHERE 1=1 AND CAST(h.mta_RecType AS int) = 0

	
	SET @EndDateTime = getutcdate()
	EXEC [aud].[proc_Log_Procedure]  
												@LogAction		= 'INSERT - CHG', 
												@LogNote		= 'Changed Records',
												@LogProcedure	= @RoutineName,
												@LogSQL			= 'Insert Into [bld].[Dataset]',
												@LogRowCount	= @@ROWCOUNT,
												@Log_TimeStart  = @StartDateTime,
												@Log_TimeEnd    = @EndDateTime;
	
	PRINT '-- deleted records:'
	
	SET @StartDateTime = getdate()
	
	INSERT INTO [bld].[Dataset]
	
	( 
	
		[BK] ,
		[Code] ,
		[DatasetName] ,
		[SchemaName] ,
		[DataSource] ,
		[BK_Schema] ,
		[BK_Group] ,
		[BK_Segment] ,
		[BK_Bucket] ,
		[ShortName] ,
		[SRC_ShortName] ,
		[dwhTargetShortName] ,
		[ReplaceAttributeNames] ,
		[Prefix] ,
		[PostFix] ,
		[Description] ,
		[BK_ContactGroup] ,
		[bk_ContactGroup_Data_Logistics] ,
		[Data_Logistics_Info] ,
		[bk_ContactGroup_Data_Supplier] ,
		[Data_Supplier_Info] ,
		[BK_Flow] ,
		[TimeStamp] ,
		[BusinessDate] ,
		[RecordSrcDate] ,
		[WhereFilter] ,
		[SCD] ,
		[DistinctValues] ,
		[PartitionStatement] ,
		[BK_RefType_ObjectType] ,
		[FullLoad] ,
		[InsertOnly] ,
		[InsertNoCheck] ,
		[BigData] ,
		[BK_Template_Load] ,
		[BK_Template_Create] ,
		[CustomStagingView] ,
		[BK_RefType_RepositoryStatus] ,
		[IsSystem] ,
		[LayerName] ,
		[BK_LinkedService] ,
		[LinkedServiceName] ,
		[BK_DataSource] ,
		[BK_Layer] ,
		[CreateDummies] ,
		[FlowOrder] ,
		[FlowOrderDesc] ,
		[FirstDefaultDWHView] ,
		[DatasetType] ,
		[ObjectType] ,
		[SRC_ObjectType] ,
		[TGT_ObjectType] ,
		[RepositoryStatusName] ,
		[RepositoryStatusCode] ,
		[isDWH] ,
		[isSRC] ,
		[isTGT] ,
		[isRep] ,
		[view_defintion_contains_business_logic] ,
		[view_defintion] ,
		[ToDeploy] 
		, [mta_BK], [mta_BKH], [mta_RH], [mta_Source], [mta_RecType]) 
	SELECT 
		src.[BK] ,
		src.[Code] ,
		src.[DatasetName] ,
		src.[SchemaName] ,
		src.[DataSource] ,
		src.[BK_Schema] ,
		src.[BK_Group] ,
		src.[BK_Segment] ,
		src.[BK_Bucket] ,
		src.[ShortName] ,
		src.[SRC_ShortName] ,
		src.[dwhTargetShortName] ,
		src.[ReplaceAttributeNames] ,
		src.[Prefix] ,
		src.[PostFix] ,
		src.[Description] ,
		src.[BK_ContactGroup] ,
		src.[bk_ContactGroup_Data_Logistics] ,
		src.[Data_Logistics_Info] ,
		src.[bk_ContactGroup_Data_Supplier] ,
		src.[Data_Supplier_Info] ,
		src.[BK_Flow] ,
		src.[TimeStamp] ,
		src.[BusinessDate] ,
		src.[RecordSrcDate] ,
		src.[WhereFilter] ,
		src.[SCD] ,
		src.[DistinctValues] ,
		src.[PartitionStatement] ,
		src.[BK_RefType_ObjectType] ,
		src.[FullLoad] ,
		src.[InsertOnly] ,
		src.[InsertNoCheck] ,
		src.[BigData] ,
		src.[BK_Template_Load] ,
		src.[BK_Template_Create] ,
		src.[CustomStagingView] ,
		src.[BK_RefType_RepositoryStatus] ,
		src.[IsSystem] ,
		src.[LayerName] ,
		src.[BK_LinkedService] ,
		src.[LinkedServiceName] ,
		src.[BK_DataSource] ,
		src.[BK_Layer] ,
		src.[CreateDummies] ,
		src.[FlowOrder] ,
		src.[FlowOrderDesc] ,
		src.[FirstDefaultDWHView] ,
		src.[DatasetType] ,
		src.[ObjectType] ,
		src.[SRC_ObjectType] ,
		src.[TGT_ObjectType] ,
		src.[RepositoryStatusName] ,
		src.[RepositoryStatusCode] ,
		src.[isDWH] ,
		src.[isSRC] ,
		src.[isTGT] ,
		src.[isRep] ,
		src.[view_defintion_contains_business_logic] ,
		src.[view_defintion] ,
		src.[ToDeploy] 
		, src.[mta_BK], src.[mta_BKH], src.[mta_RH], src.[mta_Source], [mta_RecType] = -1
	FROM  [bld].[vw_Dataset] src
	LEFT JOIN #100_Dataset_010_DatasetSrc h ON h.[mta_BKH] = src.[mta_BKH] AND h.[mta_Source] = src.[mta_Source]
	WHERE 1=1 AND h.[mta_BKH] IS null AND  src.mta_Source = '[bld].[tr_100_Dataset_010_DatasetSrc]'
	
	
	SET @EndDateTime = getutcdate()
	EXEC [aud].[proc_Log_Procedure]  
												@LogAction		= 'INSERT - DEL', 
												@LogNote		= 'Changed Deleted',
												@LogProcedure	= @RoutineName,
												@LogSQL			= 'Insert Into [bld].[Dataset]',
												@LogRowCount	= @@ROWCOUNT,
												@Log_TimeStart  = @StartDateTime,
												@Log_TimeEnd    = @EndDateTime
												;
	
	-- Clean up ...
	IF OBJECT_ID('tempdb..#100_Dataset_010_DatasetSrc') IS NOT NULL 
DROP TABLE #100_Dataset_010_DatasetSrc;
	
	SET @EndDateTime =  getutcdate()
	SET @Duration = datediff(SS,@StartDateTime, @EndDateTime)
	PRINT 'Load "load_100_Dataset_010_DatasetSrc" took ' +CAST(@Duration AS varchar(10))+ ' second(s)'