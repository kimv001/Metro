
CREATE VIEW [rep].[vw_datasetsrcfileproperties] AS /*
    View is generated by  : metro
    Generated at          : 2025-01-06 16:02:25
    Description           : View on stage table
    */
SELECT -- List of columns:
 ltrim(rtrim(cast([bk] AS varchar(255)))) AS [bk],

       ltrim(rtrim(cast([code] AS varchar(255)))) AS [code],

       ltrim(rtrim(cast([name] AS varchar(255)))) AS [name],

       ltrim(rtrim(cast([description] AS varchar(255)))) AS [description],

       ltrim(rtrim(cast([bk_srcdataset] AS varchar(255)))) AS [bk_srcdataset],

       ltrim(rtrim(cast([active] AS varchar(255)))) AS [active],

       ltrim(rtrim(cast([bk_fileformat] AS varchar(255)))) AS [bk_fileformat],

       ltrim(rtrim(cast([filesystem] AS varchar(255)))) AS [filesystem],

       ltrim(rtrim(cast([folder] AS varchar(255)))) AS [folder],

       ltrim(rtrim(cast([filename] AS varchar(255)))) AS [filename],

       ltrim(rtrim(cast([filemask] AS varchar(255)))) AS [filemask],

       ltrim(rtrim(cast([bk_schedule_expected] AS varchar(255)))) AS [bk_schedule_expected],

       ltrim(rtrim(cast([expectedfilesize] AS varchar(255)))) AS [expectedfilesize],

       ltrim(rtrim(cast([expectedfilecount] AS varchar(255)))) AS [expectedfilecount],

       ltrim(rtrim(cast([ispgp] AS varchar(255)))) AS [ispgp],

       ltrim(rtrim(cast([dateinfilenamestartpos] AS varchar(255)))) AS [dateinfilenamestartpos],

       ltrim(rtrim(cast([dateinfilenamelength] AS varchar(255)))) AS [dateinfilenamelength],

       ltrim(rtrim(cast([dateinfilenameformat] AS varchar(255)))) AS [dateinfilenameformat],

       ltrim(rtrim(cast([dateinfilenameexpression] AS varchar(MAX)))) AS [dateinfilenameexpression],

       ltrim(rtrim(cast([testdateinfilename] AS varchar(255)))) AS [testdateinfilename],

       ltrim(rtrim(cast([issystem] AS varchar(255)))) AS [issystem],

       ltrim(rtrim(cast([filesize] AS varchar(255)))) AS [filesize],

       ltrim(rtrim(cast([threshold] AS varchar(255)))) AS [threshold],

       ltrim(rtrim(cast([mta_source] AS varchar(255)))) AS [mta_source],

       ltrim(rtrim(cast([mta_loaddate] AS varchar(255)))) AS [mta_loaddate], -- Meta data columns:
 mta_rownum = row_number() OVER (
                                 ORDER BY [bk] ASC),

       mta_bk = upper(isnull(ltrim(rtrim(cast([bk] AS varchar(500)))), '-')),

       mta_bkh = convert(char(64), hashbytes('SHA2_512', upper(isnull(ltrim(rtrim(cast([bk] AS varchar(500)))), '-'))), 2),

       mta_rh = convert(char(64), hashbytes('SHA2_512', upper(isnull(ltrim(rtrim(cast([bk] AS varchar(255)))), '-') + '|' + isnull(ltrim(rtrim(cast([code] AS varchar(255)))), '-') + '|' + isnull(ltrim(rtrim(cast([name] AS varchar(255)))), '-') + '|' + isnull(ltrim(rtrim(cast([description] AS varchar(255)))), '-') + '|' + isnull(ltrim(rtrim(cast([bk_srcdataset] AS varchar(255)))), '-') + '|' + isnull(ltrim(rtrim(cast([active] AS varchar(255)))), '-') + '|' + isnull(ltrim(rtrim(cast([bk_fileformat] AS varchar(255)))), '-') + '|' + isnull(ltrim(rtrim(cast([filesystem] AS varchar(255)))), '-') + '|' + isnull(ltrim(rtrim(cast([folder] AS varchar(255)))), '-') + '|' + isnull(ltrim(rtrim(cast([filename] AS varchar(255)))), '-') + '|' + isnull(ltrim(rtrim(cast([filemask] AS varchar(255)))), '-') + '|' + isnull(ltrim(rtrim(cast([bk_schedule_expected] AS varchar(255)))), '-') + '|' + isnull(ltrim(rtrim(cast([expectedfilesize] AS varchar(255)))), '-') + '|' + isnull(ltrim(rtrim(cast([expectedfilecount] AS varchar(255)))), '-') + '|' + isnull(ltrim(rtrim(cast([ispgp] AS varchar(255)))), '-') + '|' + isnull(ltrim(rtrim(cast([dateinfilenamestartpos] AS varchar(255)))), '-') + '|' + isnull(ltrim(rtrim(cast([dateinfilenamelength] AS varchar(255)))), '-') + '|' + isnull(ltrim(rtrim(cast([dateinfilenameformat] AS varchar(255)))), '-') + '|' + isnull(ltrim(rtrim(cast([dateinfilenameexpression] AS varchar(255)))), '-') + '|' + isnull(ltrim(rtrim(cast([testdateinfilename] AS varchar(255)))), '-') + '|' + isnull(ltrim(rtrim(cast([issystem] AS varchar(255)))), '-') + '|' + isnull(ltrim(rtrim(cast([filesize] AS varchar(255)))), '-') + '|' + isnull(ltrim(rtrim(cast([threshold] AS varchar(255)))), '-') + '|' + isnull(ltrim(rtrim(cast([mta_source] AS varchar(255)))), '-') + '|' + isnull(ltrim(rtrim(cast([mta_loaddate] AS varchar(255)))), '-'))), 2)

  FROM [rep].[datasetsrcfileproperties]

 WHERE 1 = 1

   AND 1 = 1

   AND isnull(active, '1') = '1'

   AND isnull(ltrim(rtrim([bk])), '') != ''
