

CREATE PROCEDURE [rep].[Helper_adf_Views] @table [varchar] (255)
	,@schemaname [varchar] (255)
	,@envTableStatus [varchar] (20)
	,@envTable [varchar] (20)
	AS
/*
Generated by:			BHR_LANS800@kpn.com
Generated at:			2022-09-22 14:55:27.
TemplateName:  			Load Dependencies per Status
TemplateDescription:	
TemplateVersion:		1
DeployVersion:			1

History
Date				Author							Description
202220922			Martijn van der Lans			Inital
202201220			Kim Vermeij						Renamed:	@env to @envTableStatus 	, this is an indicator of the devops status. Is it just in dev or in another DTAP state
													Added:		@envTable					, it gives context of the location of the datasets, it is used for the connection strings to source and target datasets

Examples 
EXEC [rep].[Helper_adf_Views]  @table  = 'Connections_Sto_Table' , @schemaname = 'adf' ,@env = -1   --alles voor DEV
EXEC [rep].[Helper_adf_Views]  @table  = '[Dependencies]' , @schemaname = '[adf]' ,@env = 1         -- alleen PRD
*/
DECLARE @sql VARCHAR(max)

SET @sql = '
	SELECT * 
	FROM ' + @schemaname + '.' + @table + ' 
	where 1=1
		and [RepositoryStatusCode]  >= ''' + @envTableStatus + '''  
		and [Environment]  = ''' + @envTable + '''  
	
	'
	;

PRINT (@sql)

EXEC (@sql)