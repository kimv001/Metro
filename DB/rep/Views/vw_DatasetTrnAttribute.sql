create view rep.vw_DatasetTrnAttribute as
/*
View is generated by  : metro
Generated at          : 2023-02-15 05:30:46
Description           : View on stage table
*/

Select 
	-- List of columns:
	Cast([BK] as varchar(255)) as [BK],Cast([Code] as varchar(255)) as [Code],Cast([Name] as varchar(255)) as [Name],Cast([BK_DatasetTrn] as varchar(255)) as [BK_DatasetTrn],Cast([DatasetTrn] as varchar(255)) as [DatasetTrn],Cast([AttributeName] as varchar(255)) as [AttributeName],Cast([Description] as varchar(255)) as [Description],Cast([Expression] as varchar(255)) as [Expression],Cast([DistributionHashKey] as varchar(255)) as [DistributionHashKey],Cast([NotInRH] as varchar(255)) as [NotInRH],Cast([BusinessKey] as varchar(255)) as [BusinessKey],Cast([SrcName] as varchar(255)) as [SrcName],Cast([BK_RefType_DataType] as varchar(255)) as [BK_RefType_DataType],Cast([Isnullable] as varchar(255)) as [Isnullable],Cast([OrdinalPosition] as varchar(255)) as [OrdinalPosition],Cast([MaximumLength] as varchar(255)) as [MaximumLength],Cast([Precision] as varchar(255)) as [Precision],Cast([Scale] as varchar(255)) as [Scale],Cast([Collation] as varchar(255)) as [Collation],Cast([Active] as varchar(255)) as [Active]
	
	-- Meta data columns:
	, mta_RowNum     = Row_Number() Over (Order By [BK] asc)
	, mta_BK         = Upper(Isnull(Ltrim(Rtrim(Cast([BK] as varchar(500)))),'-'))
	, mta_BKH        = Convert(char(64),(hashbytes('sha2_512',
								Upper(Isnull(Ltrim(Rtrim(Cast([BK] as varchar(500)))),'-'))
							)),2)
	, mta_RH         = Convert(char(64),(Hashbytes('sha2_512',upper(
								isnull(ltrim(rtrim(cast([BK]as varchar(255))	)),'-')+'|'+isnull(ltrim(rtrim(cast([Code]as varchar(255))	)),'-')+'|'+isnull(ltrim(rtrim(cast([Name]as varchar(255))	)),'-')+'|'+isnull(ltrim(rtrim(cast([BK_DatasetTrn]as varchar(255))	)),'-')+'|'+isnull(ltrim(rtrim(cast([DatasetTrn]as varchar(255))	)),'-')+'|'+isnull(ltrim(rtrim(cast([AttributeName]as varchar(255))	)),'-')+'|'+isnull(ltrim(rtrim(cast([Description]as varchar(255))	)),'-')+'|'+isnull(ltrim(rtrim(cast([Expression]as varchar(255))	)),'-')+'|'+isnull(ltrim(rtrim(cast([DistributionHashKey]as varchar(255))	)),'-')+'|'+isnull(ltrim(rtrim(cast([NotInRH]as varchar(255))	)),'-')+'|'+isnull(ltrim(rtrim(cast([BusinessKey]as varchar(255))	)),'-')+'|'+isnull(ltrim(rtrim(cast([SrcName]as varchar(255))	)),'-')+'|'+isnull(ltrim(rtrim(cast([BK_RefType_DataType]as varchar(255))	)),'-')+'|'+isnull(ltrim(rtrim(cast([Isnullable]as varchar(255))	)),'-')+'|'+isnull(ltrim(rtrim(cast([OrdinalPosition]as varchar(255))	)),'-')+'|'+isnull(ltrim(rtrim(cast([MaximumLength]as varchar(255))	)),'-')+'|'+isnull(ltrim(rtrim(cast([Precision]as varchar(255))	)),'-')+'|'+isnull(ltrim(rtrim(cast([Scale]as varchar(255))	)),'-')+'|'+isnull(ltrim(rtrim(cast([Collation]as varchar(255))	)),'-')+'|'+isnull(ltrim(rtrim(cast([Active]as varchar(255))	)),'-')
							))),2)	
	, mta_Source     = mta_Source
	, mta_Loaddate   = Cast(mta_LoadDate as datetime2)
From rep.[DatasetTrnAttribute]
Where 1=1
	and isnull(Active,'1') = '1' 
	and isnull([BK],'') != ''	;